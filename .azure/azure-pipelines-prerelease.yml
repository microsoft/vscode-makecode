# Currently only run this pipeline on request 
trigger: none
pr: none

# Possibly nightly schedule to use if desired
# schedules:
  # - cron: '0 9 * * 1-5' # 9am UTC, Monday-Friday 2am PDT
    # displayName: Nightly Release Schedule
    # always: true
    # branches:
      # include:
        # - main

strategy:
  matrix:
    linux:
      imageName: 'ubuntu-latest'
    # Need a 1ES specific image here?
    # mac:
      # imageName: 'macos-latest'
    # windows:
      # imageName: 'windows-latest'

pool:
  vmImage: $(imageName)

stages:
  - stage: Build
  displayName: Build the VSIX
  jobs:
  - job: Build
    steps:
    - template: templates/build.yml
    parameters:
      isPreRelease: true
  
  # Stage provides a manual approval step before the publish stage is run
  - stage: Approval
  displayName: Approve the release
  jobs:
    - deployment: ApproveRelease
        displayName: "Approve Release"
        environment: "makecode" # Need to define this env in AzDO Pipeline environments
        strategy:
          runOnce:
            deploy:
              steps:
                - checkout: none


  - stage: Publish
  displayName: Publish the VSIX
  dependsOn:
    - Build
    - Approval
  jobs:
  - job: Publish
    steps:
    - template: templates/publish.yml
    parameters:
      isPreRelease: true
